# инстукция
заходим в кабинет клиента

# Создание приложения
переходим сюда https://oauth.yandex.ru/

кнопка создать справа-сверху

выбираем для "для авторизации пользователей"

вводим имя, иконку

веб-сервисы, redirect url - https://oauth.yandex.ru/verification_code, sugget hostname - пустой

запрашиваемые права - direct:api

создать<br/><br/>

# Приготовления к получению постоянного токена
ставим postman

создаем вкладку, в строке отправки выбираем post, вставляем ссылку для отправки - https://oauth.yandex.ru/token

ниже выбираем body, x-www-form-urlencoded

дальше ключ-значение: grant_type - authorization_code, client_id - ClientId созданного приложения, client_secret - Client secret созданного приложения, code - пока пустой<br/><br/>

# Получение временного и постоянного токена
переходим сюда вставляя CLIENT_ID - https://oauth.yandex.ru/authorize?response_type=code&client_id=<CLIENT_ID_созданного_приложения>

на экране временный токен, вставляем его в code в postman и отправляем

в ответе получаем access_token, это постоянный токен, ***его надо обновлять раз в год***

если выдает ошибку - ещё раз запрашиваем временный токен и вставляем<br/><br/>

# Заявка на получение полного доступа к Яндекс.Директ
в директа вкладка инструменты -> api -> мои заявки -> новая -> полный доступ

Укажите один или несколько контактов, по которым с вами быстро сможет связаться служба поддержки - mail@road-map.online

Данные о компании: название - Roadmap, сайт - Roadmap.su

Выберите утверждение, которое лучше всего описывает специфику вашей работы. Вы: - Агентство и автоматизируете работу своих сотрудников с кампаниями клиентов

Технические данные о приложении: Язык программирования - C#, Протокол - JSON, Версия библиотек - Google.Apis.Auth 1.73.0, Google.Apis.Sheets.v4 1.72.0.3966

Для примера успешной работы приложения, укажите один или несколько логинов в Директе, для которых оно используется - логин клиента

Для чего предназначено приложение - Автоматизировать регулярную работу по управлению кампаниями в Директе

Основные функции приложения - Управление кампаниями и объявлениями

Какие новые возможности работы с Директом дает ваше приложение пользователям? - Автоматизация работы с рся, каждый час корректирует запрет показов на площадках

Опишите схему взаимодействия вашего приложения с Директом -

<br/><br/>
"Приложение реализовано в виде серверной функции (Yandex Cloud Function), которая запускается по расписанию раз в час.

Функция авторизуется в Google Sheets API для получения актуального списка стоп-слов.

Функция авторизуется в API Яндекс.Директа с использованием OAuth-токена.

Запрашивается отчет по площадкам за последние 30 дней.

Полученные площадки сравниваются со стоп-словами.

Обнаруженные площадки добавляются в Негативный список площадок кампании через метод UpdateCampaignNegativeSites."
<br/><br/>

скрин логов из релиза - Логи тестового запуска

скрин окружение из релиза - Переменные окружения, используемые в коде

скрин стоп-слова из релиза - Список стоп-слов в гугл таблицах

документ спецификации из релиза - Документ спецификации
<br/><br/>

отправить<br/><br/>

# Яндекс.Cloud
переходим сюда - https://console.yandex.cloud

слева-снизу выбираем аккаунт - mail@road-map.onlineи, на нём - organization-mail@road-map.online<br/><br/>

## Cloud functions

вписываем в поиск cloud functions, выбираем

справва-сверху добавить

вписываем имя функции

выбираем dotnet8 (C#)

Способ - zip, загружаем архив из релиза

Точка входа - YandexDirectWorker.Handler

Таймаут - 10 секунд

Сервисный аккаунт - ban-show-api-tool-2<br/><br/>

## Переменные окружения

GOOGLE_API_KEY - будет в битриксе и Яндекс.Cloud

либо если с ключем проблема:
<br/><br/>

Перейдите в Google Cloud Console.

Перейдите в раздел "API и сервисы" → "Учетные данные".

Нажмите "Создать учетные данные" → "Ключ API".

ОБЯЗАТЕЛЬНО: В разделе "API и сервисы" убедитесь, что Google Sheets API включен для вашего проекта.

Полученный ключ (длинная строка) вы будете использовать.
<br/><br/>

SHEET_ID - будет в битриксе и Яндекс.Cloud, либо если нужна другая таблица - создаем, берем id между /d/ и /edit

SHEET_RANGE_BLACKLIST - Лист1!A2:A

SHEET_RANGE_WHITELIST - Лист1!B2:B

YANDEX_TOKEN - полученный постоянный токен
